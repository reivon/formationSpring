<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">

    <title>Comprendre Spring</title>

    <meta name="description" content="Formation générale sur le framework Spring">
    <meta name="author" content="Tony MEMBOT">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="reveal-3.3.0/css/reveal.css">
    <link rel="stylesheet" href="reveal-3.3.0/css/theme/sky.css" id="theme">
    <link rel="stylesheet" href="reveal-3.3.0/lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'reveal-3.3.0/css/print/pdf.css' : 'reveal-3.3.0/css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="reveal-3.3.0/lib/js/html5shiv.js"></script>
    <![endif]-->
</head>
<body>
<div class="reveal">
    <div class="slides">

        <!-- *************************************************************** -->
        <!-- 0. Titre & plan -->
        <!-- *************************************************************** -->

        <section>
            <h1>Spring</h1>
            <h3>Formation au Framework couteau suisse</h3>
            <p>
                <small>Créé par Tony MEMBOT via l'API de présentation <a href="https://github.com/hakimel/reveal.js">Reveal.js</a>
                </small>
            </p>

            <aside class="notes">
                Se présenter.<br/>
                Leur domaine / niveau struts/spring/MVC/...<br/>
                Pas formation expert. Il faut fouiller/adapter.<br/>
            </aside>
        </section>

        <section>
            <h2>Spring</h2>
            <ul>
                <li>C'est quoi spring ?</li>
                <li>Spring Core</li>
                <li>Spring MVC</li>
                <li>Spring Security</li>
                <li>Spring Batch</li>
                <li>Aller plus loin avec Spring</li>
            </ul>

            <aside class="notes">
            </aside>
        </section>

        <!-- *************************************************************** -->
        <!-- 1. C'est quoi Spring -->
        <!-- *************************************************************** -->

        <section>

            <section>
                <h2>C'est quoi Spring ?</h2>

                <aside class="notes">
                </aside>
            </section>

            <section>
                <h3>Un conteneur léger</h3>
                <br/>
                <ul>
                    <li>Framework reposant sur 3 grands principes
                        <ul>
                            <li class="fragment">Inversion de contrôle</li>
                            <li class="fragment">Programmation orientée aspect</li>
                            <li class="fragment">Couche d'abstraction (pour d'autres API)</li>
                        </ul>
                    </li>
                    <li class="fragment"><b>2003</b> : première version</li>
                    <li class="fragment"><b>2016</b> : 4.2.3</li>
                    <li class="fragment"><b>Libre</b></li>
                </ul>

                <aside class="notes">
                    Conteneur léger : brique de base pour instancier des objets et les mettre en relation.<br/>
                    Pour faire plus, on rajoute des briques.</br />
                    Tomcat = conteneur léger, jboss conteneur lourd<br />
                    Inversion de contrôle = Injection de dépendance. (exemple par la suite)<br/>
                    Définir programmation orienté aspect => transversale.<br/>
                    Couche d'abstraction : Hibernate / quartz / velocity / jdbc / ...<br/>
                    Entre chaque version il y a eu de nombreuses et importantes évolution.<br/>
                </aside>
            </section>

            <section>
                <img src="img/spring-overview.png" style="border:0">
            </section>

            <section>
                <h2>Attention aux versions !</h2>
                <h4>Une version majeure = grand ménage de printemps</h4>
                <ul><li>La formation se base sur les versions suivantes :
                        <ul>
                            <li>Spring Framework : 4.3.2.RELEASE</li>
                            <li>Spring Security : 4.1.3.RELEASE</li>
                            <li>Spring Batch : 3.0.7.RELEASE</li>
                        </ul>
                    </li>
                </ul>

                <aside class="notes">
                    évoluer est nécessaire. C'est une force de spring
                </aside>
            </section>

        </section>

        <!-- *************************************************************** -->
        <!-- 2.1 Spring core -->
        <!-- *************************************************************** -->

        <section>

            <section>
                <h2>Spring core</h2>
            </section>

            <section>
                <h3>IoC : Inversion of Control</h3>
                <br/>
                <ul>
                    <li>Aujourd'hui renommé injection de dépendance</li>
                    <li>Déresponsabilisation / Déspécialisation des classes</li>
                    <li>On injecte dynamiquement les dépendances plutôt que de les écrire explicitement dans le code</li>
                </ul>

                <aside class="notes">
                </aside>
            </section>

            <section>
                <pre><code data-trim>
public class Parking {
    private Voiture voiture;

    /** Constructeur qui crée une voiture spécifique: pas d'IoC */
    public Parking() {
        voiture = new Clio();
    }

    /** Constructeur avec voiture: compatible IoC */
    public Parking(Voiture voiture) {
        this.voiture = voiture;
    }
}
                </code></pre>
                <aside class="notes">
                    Parking a ici la responsabilité de l'instanciation de la Clio. Ca ne peut être que ça.<br/>
                    Si l'application évolue, ou on souhaite l'étendre, ou on souhaite mocker pour test => on doit modifier le
                    code.
                </aside>
            </section>

            <section>
                <h3>Exemple XML</h3>
                <ul>
                    <li>Dépendances maven sur spring-context</li>
                    <li>Un fichier xml de configuration principal</li>
                    <li>Déclaration de bean et d'injection de dépendance via l'xml</li>
                    <li>Chargement du context spring pour utilisation</li>
                    <li>Explorons le projet Spring 1 ...</li>
                </ul>

                <aside class="notes">
                    Projet exemple : <b>springFormation_1</b>.<br/>
                    Dépendance de context : https://mvnrepository.com/artifact/org.springframework/spring-context/4.3.2.RELEASE
                    app / beans / core / expression.<br/>
                    Il est possible de découper le fichier XML en réalisant des imports (Mais un seul point d'entrée).
                    <pre><code><import resource="classpath:config/spring/that-other-xml-conf.xml"/></code></pre>
                </aside>
            </section>

            <section>
                <h3>Exemple Annotation</h3>
                <br/>
                <ul>
                    <li>Dépendances identiques</li>
                    <li>Une classe de configuration principale</li>
                    <li>Déclaration des beans et injection de dépendance via les annotations</li>
                    <li>Chargement du context spring dans le main légèrement différent</li>
                    <li>Explorons le projet Spring 2 ...</li>
                </ul>

                <aside class="notes">
                    Projet exemple : <b>springFormation_2</b>.<br/>
                    On peut retrouver l'annotation @Bean aussi<br/>
                    Ainsi, si dans messageServiceImpl on supprime le @Component, on peut déclarer dans la classe Application:<br/>
                    <pre><code>
                    @Bean
                    public MessageServiceImpl messageService(){
                        return new MessageServiceImpl();
                    }
                    </code></pre>
                    Il est à noter que l'on peut avoir plusieurs @Configuration si on souhaite découper notre application.<br/>
                    On peut réaliser des héritages / dépendances avec @Import(nomClass.class)<br/>
                </aside>
            </section>

            <section>
                <h3>Annotation ou XML ?</h3>
                <ul>
                    <li>Pas de best solution</li>
                    <li>On peut quasi tout faire dans les deux solutions</li>
                    <li>Utiliser le meilleur des deux : un mix, exemple
                        <ul>
                            <li>Annotation pour tout ce qui est <b>static</b></li>
                            <li>XML pour tout ce qui est plus <b>dynamique</b></li>
                        </ul>
                    </li>
                    <li>Mais attention, la communauté tend vers le full annotation</li>
                </ul>

                <aside class="notes">
                </aside>
            </section>

        </section>

        <!-- *************************************************************** -->
        <!-- 2.2 Déclaration d'un bean -->
        <!-- *************************************************************** -->

        <section>

            <section>
                <h3>@Component</h3>
                <ul>
                    <li>Sur la classe VoitureDeCourse, va créer un bean nommé "voitureDeCourse"</li>
                    <li>On peut préciser ce nom <code data-trim>@Component(value = "voiture2course")</code></li>
                    <li>@Service, @Controller, @Repository sont des spécialisations</li>
                    <li>On laisse spring gérer l'instanciation</li>
                </ul>

                <aside class="notes">
                    @Service, ... sont des spécialisations dans le but d'utiliser l'AOP.
                </aside>
            </section>

            <section>
                <h3>@Bean</h3>
                <ul>
                    <li>Disponible uniquement si on utilise @Configuration</li>
                    <li>Sur la méthode myVoitureDeCourse, va créer un bean nommé "myVoitureDeCourse"</li>
                    <li>On peut préciser ce nom <code data-trim>@Bean(name={"voiture2course"})</code></li>
                    <li>C'est le développeur qui gère l'instanciation</li>
                </ul>

                <aside class="notes">
                    Attention, on ne peut plus utiliser l'AOP sur des instanciations de type @Bean.
                    => http://zezutom.blogspot.fr/2014/02/spring-series-part-5-component-vs-bean.html
                    @Autowired peut injecter un @Bean
                </aside>
            </section>

            <section>
                <h3>@Bean factory</h3>
                <pre><code data-trim>
@Bean
@Scope("prototype")
public SomeService someService() {
    switch (state) {
        case 1:
            return new Impl1();
        case 2:
            return new Impl2();
        case 3:
            return new Impl3();
        default:
            return new Impl();
    }
}
                </code></pre>

                <aside class="notes">
                    Ce cas peut être utile pour du mock par exemple, ou pour instancier des classes différentes selon un
                    environnement ...<br/>
                    La différence entre les deux est ténue. On préfera garder @Component généralement.
                </aside>
            </section>

        </section>

        <!-- *************************************************************** -->
        <!-- 2.3 Injection de dépendance -->
        <!-- *************************************************************** -->

        <section>

            <section>
                <h3>Les injections de dépendances</h3>

                <aside class="notes">
                </aside>
            </section>

            <section>
                <h3>@Autowired</h3>

                <ul>
                    <li>Injection par <b>type</b></li>
                    <li>Et si on a deux implémentations de la même interface ? => Démonstration</li>
                    <li>Avec <code data-trim>@Qualifier("name")</code> : injection par <b>nom</b></li>
                    <li>Peut préciser qu'il n'est pas obligatoire <code>@Autowired(required = false)</code></li>
                    <li>Annotation Spring</li>
                </ul>

                <aside class="notes">
                    Démonstration : <br />
                    1. Créer une classe MessageServiceAutreImpl qui implémente MessageService<br />
                    2. Lancer l'appli. => plante.<br />
                    pas obligatoire = ne plante pas.<br />
                </aside>
            </section>

            <section>
                <h4>@Resource</h4>

                <ul>
                    <li>Injection par <b>type</b></li>
                    <li>Même souci sur la double implémentation que @Component</li>
                    <li>Pour injecter par nom : <pre><code data-trim>@Resource(name = "name")</code></pre></li>
                    <li>Annotation Java</li>
                </ul>

                <aside class="notes">
                </aside>
            </section>

            <section>
                <pre><code data-trim>
@Resource(name = "toto")
private Toto toto;
                </code></pre>
                <p>==</p>
                <pre><code data-trim>
@Autowired
@Qualifier("toto")
private Toto toto;
                </code></pre>

                <aside class="notes">
                </aside>
            </section>

            <section>
                <h4>@Resource ou @Autowired ?</h4>
                <p>Sur des injections de propriétés, il est préférable d'utiliser @Resource qui est un standard Java et qui est fait pour ça.</p>
                <h4>Setter ou constructeur ?</h4>
                <p>On peut mixer les deux. La logique veut qu'on mette en setter les dépendances facultatives et en constructeur les obligatoires.</p>

                <aside class="notes">
                </aside>
            </section>

            <section>
                <h4>Le scope d'injection</h4>
                <ul>
                    <li class="fragment">Modifions un peu le projet Spring2 ...</li>
                    <li class="fragment">Par défaut, tout est singleton !</li>
                    <li class="fragment">Scopes :
                        <ul>
                            <li>Singleton</li>
                            <li>Prototype</li>
                            <li>Request *</li>
                            <li>Session *</li>
                            <li>GlobalSession *</li>
                        </ul>
                    </li>
                </ul>

                <aside class="notes">
                    Faire un test sur formationSpring_2 en ajoutant un 2ème service dans MessagePrinter.<br/>
                    Puis ajouter dans l'appel d'affichage<br/>
                    System.out.println(service2.getMessage());<br/>
                    service2.setMessage("message modifié");<br/>
                    System.out.println(service.getMessage());<br/>
                    System.out.println(service2.getMessage());<br/>
                    <br/>
                    * = que dans spring web.<br/>
                    Ajouter => @Scope("prototype")<br/>
                </aside>
            </section>

            <section>
                <h4>Injection de collections</h4>
                <ul>
                    <li>Types disponibles :<ul>
                        <li>list</li>
                        <li>set</li>
                        <li>map</li>
                        <li>props</li>
                    </ul></li>
                    <li class="fragment">Tout est string dans un fichier xml ...</li>
                    <li class="fragment">... mais il existe des converters automatiques</li>
                    <li class="fragment">Explorons le projet 3</li>
                    <li class="fragment">Et l'injection d'une valeur null ?</li>
                    <li class="fragment"><pre><code data-trim><value><null /></value></code></pre></li>
                </ul>

                <aside class="notes">
                    Exemple avec le projet spring 3.<br/>
                    L'utilité de tout ça ? notamment pour injecter des listes de beans / référence.<br/>
                    Injecter null ? "" représentant une chaîne vide ?<br/>
                </aside>
            </section>
        </section>

        <!-- *************************************************************** -->
        <!-- 2.4 Plus loin dans la configuration des beans -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h2>Customiser ses beans</h2>
            </section>

            <section>
                <h3>init-method</h3>
                <pre><code data-trim><bean id="..." class="..." init-method="..."></code></pre>

                <aside class="notes">
                    Modifier le projet 1 pour ajouter une init method à messageserviceimpl qui changerait le message par exemple.
                </aside>
            </section>

            <section>
                <h3>L'héritage / Surcharge des beans</h3>
<pre><code data-trim>
<bean id="helloworld" class="fr.tuto.helloworld">
    <property name="message1" value="hello world!"></property>
    <property name="message2" value="hello second world!"></property>
</bean>

<bean id="helloindia" class="fr.tuto.helloindia" parent="helloworld">
   <property name="message1" value="hello india!"></property>
   <property name="message3" value="namaste india!"></property>
</bean>
</code></pre>

                <aside class="notes">
                    On peut rendre un bean abstract="true" sans définir de class (sera pas instancié par Spring)
                    http://www.tutorialspoint.com/spring/spring_bean_definition_inheritance.htm
                </aside>
            </section>
        </section>

        <section>
            <h3>Testons !</h3>
            <ol style="font-size:90%;">
                <li>Instancier via un new (projet 1)</li>
                <li>Compléter le projet Exo 1 ...
                    <ul>
                        <li>Créer les beans des voitures clio / ferrari / lotus</li>
                        <li>Créer deux parkings
                            <ul>
                                <li>Concession : avec deux clio, une ferrari, deux lotus</li>
                                <li>Occasion : avec deux clio, une lotus</li>
                            </ul>
                        </li>
                        <li>Les parking initialisent les niveaux d'essence via initEssence()</li>
                        <li>Créer le bean garage référençant les deux parkings et le commercial</li>
                        <li>GarageApplication doit tourner !</li>
                    </ul>
                </li>
            </ol>

            <aside class="notes">
                1. L'objet est hors contexte, pas d'initialisation de variable etc. erreur courante au début !<br/>
                2. voiture ne doit pas être instancié, les voitures = prototype<br />
                Montrer exemple spEL
            </aside>
        </section>

        <!-- *************************************************************** -->
        <!-- 2.5 Spring properties -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h3>Spring properties</h3>

                <ul>
                    <li>Externaliser les données "changeantes" / techniques</li>
                    <li>Chargement de properties dans le context spring</li>
                    <li>Récupération des valeurs directement dans l'initialisation d'un bean ou via un @value</li>
                    <li>Possibilité de mettre en place un système de surcharge</li>
                    <li>Possibilité de mettre des valeurs par défaut</li>
                </ul>

                <aside class="notes">
                    exemple du projet 4.
                    pour utiliser la variable, déclarer dans les arguments vm : -Dproject.home=c:/
                    rajouter une valeur par défaut : :c:/conf/
                </aside>
            </section>
        </section>

        <!-- *************************************************************** -->
        <!-- 3. Spring MVC -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h2>Spring Web (MVC)</h2>
            </section>

            <section>
                <h3>MVC : un petit rappel</h3>
                <img src="img/MVC_2.png"/>

                <aside class="notes">
                    découpage de responsabilité ...
                </aside>
            </section>

            <section>
                <h3>Spring & le web</h3>
                <img src="img/mvc.png"/>

                <aside class="notes">
                    spring mvc est une spécialisation de spring qui donne des outils pour gérer des pages web.
                </aside>
            </section>
        </section>

        <!-- *************************************************************** -->
        <!-- 3.1 Dispatcher -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h2>Le dispatcher</h2>
            </section>

            <section>
                <h3>Le dispatcher</h3>
                <ul>
                    <li>Spring web tourne autour du servletdispatcher (remplace notre main)</li>
                    <li>Chef d'orchestre des appels HTTP et de leurs traitements</li>
                </ul>

                <aside class="notes">
                </aside>
            </section>

            <section>
                <h3>Request HTTP basique</h3>
                <img src="img/spring_dispatcherservlet.png">

                <ol>
                    <li>Récupération du bon controller</li>
                    <li>Aiguillage (POST/GET) & préparatop, les datas</li>
                    <li>Récupération de la bonne view (JSP, ...)</li>
                    <li>Fusion des datas dans la view</li>
                </ol>

                <aside class="notes">
                    1. Après l'avoir reçu, DispatcherServlet consulte HandlerMapping pour appelerle bon Controller.<br/>
                    2. Le Controller gère la request et appel la bonne méthode (GET / POST) et prépare les objets qui vont alimentés le model ainsi que le nom du modèle.<br/>
                    3. Le DispatcherServlet utilise le ViewResolver pour récupérer la bonne view.<br/>
                    4. Le DispatcherServlet fusione les datas avec la view et retourne le résultat.<br/>
                </aside>
            </section>
            
            <section>
                <h3>Explorons le projet spring 5 ...</h3>

                <aside class="notes">
                    lancer l'appli et accéder à http://localhost:8080/hello (si lancer depuis intellij)<br/>
                    web.xml => dispatcher servlet<br/>
                    hellocontroller => @controller @requestmapping<br/>
                    hello-servlet<br/>
                    => spring recherche automatiquement le fichier {{nomservlet}}-servlet.xml<br/>
                    => on peut lui préciser d'autres noms dans le web.xml<br/>
                    => contient la ligne de scan pour les controller<br/>
                    => contient un résolver permettant de rediriger vers nos ressources jsp.<br/>
                    => le resolver peut implémenter des framework de view comme tiles / velocity / ...v
                </aside>
            </section>
        </section>

        <!-- *************************************************************** -->
        <!-- 3.2 Spring EL -->
        <!-- *************************************************************** -->

        <section>

            <section>
                <h3>Spring EL</h3>

                <ul>
                    <li>EL = Expression Language</li>
                    <li>Spring EL = EL au niveau injection / context spring</li>
                    <li>Explorons le projet spring 6 ...</li>
                </ul>

                <aside class="notes">
                    localhost:8080/hello & localhost:8080/hello/toto<br/>
                    spring-el est déjà en dépendance de webmvc<br/>
                    dépendance : ne pas oublier d'ajouter javax.servlet<br/>
                    <br/>

                    attention à la vieille erreur que les paramètres ne s'affichent pas sur les jsp
                    https://www.mkyong.com/spring-mvc/modelandviews-model-value-is-not-displayed-in-jsp-via-el/
                    (web.xml) el ne marche pas :
<pre><code  data-trim>
<!doctype web-app public
"-//sun microsystems, inc.//dtd web application 2.3//en"
"http://java.sun.com/dtd/web-app_2_3.dtd" >
</code></pre>
                    (web.xml) el marche  :
<pre><code  data-trim>
<web-app id="webapp_id" version="2.4"
         xmlns="http://java.sun.com/xml/ns/j2ee"
         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"
         xsi:schemalocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd">
</web-app>
</code></pre>
                </aside>
            </section>

        </section>

        <!-- *************************************************************** -->
        <!-- 3.3 Ressource static -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h3>Les ressources statiques</h3>

                <ul>
                    <li>Si tout est résolu par le resolver .. tout est jsp ?</li>
                    <li class="fragment">Et les js, css ?</li>
                    <li class="fragment">Spring peut définir un context de ressources statiques</li>
                    <li class="fragment">Exemple dans le projet spring 6 ..</li>
                </ul>

                <aside class="notes">
                    Exemple de spring 6 : localhost:8080/index
                    On a ajouté dans le servlet.xml
                        mvc:resources ...
                        mvc:annotation-driven ...
                    Et dans hello.jsp ajout des références et utilisation de taglib.
                </aside>
            </section>
        </section>

        <!-- *************************************************************** -->
        <!-- 3.4 Redirect & Forward -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h3>Redirect & Forward</h3>

                <ul>
                    <li>Toujours utile pour le pattern POST/Redirect/GET pour gérer les submit multiples</li>
                    <li>Redirect = retour vers le navigateur avec une réponse http 302 (redirection) vers la nouvelle url => on perd la request</li>
                    <li>Forward = redirection interne au serveur, transparente pour le navigateur et l'utilisateur => on conserve la request</li>
                    <li>
                        Depuis la 3.1, Spring intègre les RedirectAttributes ...<br/>
                        http://www.tikalk.com/redirectattributes-new-feature-spring-mvc-31/
                    </li>
                    <li>Exemple dans le projet spring 7 ..</li>
                </ul>

                <aside class="notes">
                    exemple du projet 7 : localhost:8080/index
                    RedirectAttributes = flash attribute = marche pour 1 seul redirect.
                    F5 et tout disparaît => http://www.tikalk.com/redirectattributes-new-feature-spring-mvc-31/
                </aside>
            </section>
        </section>

        <!-- *************************************************************** -->
        <!-- 3.5 Signature controller dynamique -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h3>Controller - signature dynamique</h3>

                <ul>
                    <li>Comment récupérer la request ? la response ? via l'injection spring</li>
                    <li>http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-arguments</li>
                </ul>

                <aside class="notes">
                    Exemple projet 7
                    http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-arguments
                    HttpServletResponse response
                    TimeZone timezone
                </aside>
            </section>
        </section>

        <!-- *************************************************************** -->
        <!-- 3.5 Gestion des formulaires -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h2>Gestion des formulaires</h2>
            </section>

            <section>
                <h3>Formulaire de saisie</h3>

                <ul>
                    <li>Utilisation d'une taglib pour le form</li>
                    <li>Passage des data par un bean nommé "command" par défaut (paramétrable)</li>
                    <li>Le submit popule ce bean que l'on récupère dans le controller</li>
                    <li>Exemple dans le projet spring 8 ..</li>
                </ul>

                <aside class="notes">
                    exemple du projet formationspring_8 :
                    objet "command" = bean (attention aux setter / getter)
                    nom du bean paramétrable
                </aside>
            </section>

            <section>
                <h3>Gestion des autres input</h3>

                <ul>
                    <li>Spring gère également les select, textarea, checbox, ...</li>
                    <li>Norme HTML => un checkbox décoché n'est pas envoyé dans le post</li>
                    <li>Exemple dans le projet spring 8b ..</li>
                </ul>

                <aside class="notes">
                    Des valeurs par défaut ont été mises en place.
                </aside>
            </section>

            <section>
                <h3>Gestion d'un appel Ajax</h3>

                <ul>
                    <li>Mapping object / data simplifié par Spring</li>
                    <li>Gestion de l'XML, du JSon, ...</li>
                    <li>Ajout des dépendances correspondantes</li>
                    <li>Exemple dans le projet spring 8c ..</li>
                </ul>

                <aside class="notes">
                    Ajouts dépendances jackson<br />
                    Appel JQuery Ajax. Mapping automatique.<br />
                    Attention de bien produire du JSON (on peut renseigner le produce dans le requestmapping)
                </aside>
            </section>

            <section>
                <h3>Upload de fichier</h3>

                <ul>
                    <li>Spring gère églament l'upload des fichiers</li>
                    <li>Quelques dépendances supplémentaires sont nécessaires</li>
                    <li>Exemple dans le projet spring 8d ..</li>
                </ul>

                <aside class="notes">
                    Ajout dépendances commons-fileupload & commons-io<br />
                    AJout  enctype="multipart/form-data" dans le formulaire<br/>
                    Remarque, ce n'est pas un champ form:file<br />
                </aside>
            </section>

            <section>
                <h3>Spring message / internationalisation</h3>

                <ul>
                    <li>Utilisation d'un message resource : ReloadableResourceBundleMessageSource</li>
                    <li>Injection du bean dans les classes Java</li>
                    <li>Utilisation de la taglib spring:message pour les JSP</li>
                    <li>Internationalisation :
                        <ul>
                            <li>Gérer par défaut par la locale http (navigateur)</li>
                            <li>Gestion de priorité de la locale : application_fr_fr / application_fr / application</li>
                        </ul>
                    </li>
                    <li>Exemple dans le projet spring 9 ..</li>
                </ul>

                <aside class="notes">
                    exemple du projet formationspring_9
                    on a ajouté un resolver ainsi qu'un interceptor, via l'url on peut changer la locale.
                        http://localhost:8080/student
                        http://localhost:8080/student?locale=en
                    De manière native c'est géré par le accept language de la requête http.
                    Fichiers externe à l'application ? file:/usr/local/conf/app/messages/messages
                </aside>
            </section>

            <section>
                <h3>Valider un formulaire</h3>
                <h4>Pré version spring 4.X</h4>

                <ul>
                    <li>Librairie externe implémentant jsr-303/jsr-349 bean validation, exemple :</li>
                    <li>
                        <pre><code  data-trim><dependency>
    <groupid>javax.validation</groupid>
    <artifactid>validation-api</artifactid>
    <version>1.0.0.ga</version>
</dependency>
<dependency>
    <groupid>org.hibernate</groupid>
    <artifactid>hibernate-validator</artifactid>
    <version>4.1.0.final</version>
</dependency>
                        </code></pre>
                    </li>
                    <li><a href="http://blog.netapsys.fr/spring-mvc-formulaires-et-validations-par-la-norme-jsr-303-bean-validation"/>Exemple complet</a></li>
                </ul>

                <aside class="notes">
                    C'est classique et bien détaillé, voyons plutôt la solution spring.
                </aside>
            </section>

            <section>
                <h3>Valider les informations d'un formulaire</h3>
                <h4>Post version 4.X</h4>

                <ul>
                    <li>Spring réalise son implémentation avec @validated</li>
                    <li>Création de classe implémentant l'interface Validator</li>
                    <li>Utilisation de form:error pour remonter les erreurs</li>
                    <li>Exemple dans le projet Spring 10 ..</li>
                </ul>

                <aside class="notes">
                    <pre>
                    http://www.mkyong.com/spring-mvc/spring-mvc-form-handling-example/
                    Projet Spring 10 = Spring 8 + validation.
                        on rajoute l'email pour montrer les dépendances de validator.
                        Ajout de deux validator
                        Ajout du tag form:error dans la jsp du formulaire
                        Modification du controller pour déclencher le validator
                        détail sur le messageressource => on a plusieurs fichiers de messageresource maintenant.
                            note : il y a un ordre d'application. le dernier prend le pas sur les suivant.
                            permet de faire du fallback. on charge d'abord le fichier dans l'appli puis un externe par exemple.

                    Attention ! dans le controller, l'attribut bindingresult result doit obligatoirement être placé juste après le modelattribute à valider.
                    sinon erreur 400 ! c'est le seul paramètre qui a une place conditionné au niveau des controlleurs spring.
                    => http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-methods
                    </pre>
                </aside>
            </section>

            <section>
                <h3>Filter encoding</h3>

                <ul>
                    <li>Filtre au niveau spring</li>
                    <li>Permet de traiter les données HTTP dans l'encoding cible</li>
                    <li>Ne dispense pas de setter correctement l'encoding sur les vues</li>
                </ul>

                <aside class="notes">
                    Exemple dans le projet 10
                </aside>
            </section>

        </section>

        <!-- *************************************************************** -->
        <!-- 4 Spring security -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h2>Spring security</h2>
            </section>

            <section>
                <h3>Init</h3>

                <ul>
                    <li>Gestion d'authentifications et d'autorisations</li>
                    <li>Brique à part entière (ne suis pas les versions)</li>
                    <li>Fichier de configuration à part</li>
                    <li>Configuration minimale pour une utilisation directe</li>
                    <li>Exemple dans le projet spring 11...</li>
                </ul>

                <aside class="notes">
                    web.xml<br/>
                    on ajoute le filtre de spring security dans le web.xml<br/>
                    on crée le fichier de configuration de spring security<br/>
                    test d'accès :<br/>
                    localhost:8080/welcome<br/>
                    localhost:8080/admin<br/>
                    la login page est par défaut<br/>
                    spring 4 demande de gérer des tokens crslf<br/>
                </aside>
            </section>

            <section>
                <h3>Personnalisation</h3>

                <ul>
                    <li>Personnalisation de la page de login</li>
                    <li>Personnalisation des redirection logout</li>
                    <li>...</li>
                    <li>Exemple dans le projet spring 12</li>
                </ul>

                <aside class="notes">
                    ajout d'une page de login<br/>
                    déclaration controller login<br/>
                    ajout page login<br/>
                    le logout est géré par login?logout automatiquement<br/>
                    l'erreur de log est géré par login?error automatiquement<br/>
                    username et password doivent être présent<br/>
                </aside>
            </section>
        </section>

        <!-- *************************************************************** -->
        <!-- 5 Exo Spring web -->
        <!-- *************************************************************** -->

        <!-- TODO faire l'exo 2 ! -->

        <section>
            <h3>Testons Spring Web !</h3>
            <ol style="font-size:90%;">
                <li>Compléter le projet Exo 2 ...
                    <ol>
                        <li>GarageController doit mapper / pour renvoyer la page index.jsp</li>
                        <li>Afficher le nom du commercial dans le message d'accueil</li>
                        <li>Afficher les parkings</li>
                        <li>Afficher les voitures dans chaque parking</li>
                        <li>Mettre en place un bouton permettant d'ajouter de l'essence pour tout le parking</li>
                        <li>Mettre en place un formulaire au niveau parking pour ajouter une voiture via un input</li>
                        <li>Modifier ce formulaire pour prendre une liste de nom de voitures à la place de l'input</li>
                    </ol>
                </li>
            </ol>

            <aside class="notes">
            </aside>
        </section>

        <!-- *************************************************************** -->
        <!-- 6. Spring batch -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h2>Spring Batch</h2>
            </section>

            <section>
                <h3>Spring Batch</h3>

                <ul>
                    <li>Gère des opérations récurrentes et/ou de gros volumes de données</li>
                    <li>Brique à part entière (ne suis pas les versions)</li>
                    <li>Gestion des transactions, des logs</li>
                    <li>Console d'administration web (start/stop/restart/skip/retry) </li>
                    <li>Difficile d'accès / complexe</li>
                    <li>Exemple dans le projet spring 13..</li>
                </ul>

                <aside class="notes">
                    Spring batch donne des notions communes à tous les jobs : job step itemwriter ...
                    http://projects.spring.io/spring-batch/
                    http://www.mkyong.com/tutorials/spring-batch-tutorial/
                    http://blog.netapsys.fr/spring-batch-par-lexemple-2/
                </aside>
            </section>
        </section>

        <!-- *************************************************************** -->
        <!-- 7. Spring plus loin -->
        <!-- *************************************************************** -->

        <section>
            <section>
                <h2>Aller plus loin avec Spring</h2>
            </section>

            <section>
                <h3>Spring c'est aussi du ...</h3>
                <ul>
                    <li>Cache (ehcache)</li>
                    <li>JDBC / JPA (Hibernate)</li>
                    <li>Mail</li>
                    <li>JMS</li>
                    <li>REST</li>
                    <li>AOP</li>
                    <li>Templating (thymeleaf)</li>
                    <li>...</li>
                </ul>
            </section>

            <section>
                <h3>Spring 5</h3>
                <ul>
                    <li>Release prévu en Mars 2017</li>
                    <li>Niveau de compatibilité drastiquement augmenté
                        <ul>
                            <li>Java 8+</li>
                            <li>Hibernate 5+</li>
                            <li>JPA 2.1+</li>
                            <li>Inclusion de spring reactive</li>
                        </ul>
                    </li>
                </ul>

                <aside class="notes">
                    spring reactive => Programmation réactive = programmation avec des flux de données asynchrones
                    http://home.heeere.com/tech-intro-programmation-reactive.html
                </aside>
            </section>

            <section>
                <h3>Spring 5</h3>
                <ul>
                    <li>Abandon du support de nombreuses librairies :
                        <ul>
                            <li>PortletMVC</li>
                            <li>JDO</li>
                            <li>Guava caching</li>
                            <li>JasperReports</li>
                            <li>OpenJPA</li>
                            <li>Tiles 2</li>
                            <li>XMLBeans</li>
                            <li>Velocity</li>
                        </ul>
                    </li>
                </ul>
            </section>
        </section>

        <section>
            <h1>Merci !</h1>
        </section>

    </div> <!-- End div slide -->

</div> <!-- End div Reveal -->

<!-- Scripts insertions -->
<script src="reveal-3.3.0/lib/js/head.min.js"></script>
<script src="reveal-3.3.0/js/reveal.js"></script>

<script>
    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
            {
                src: 'reveal-3.3.0/lib/js/classList.js', condition: function () {
                    return !document.body.classList;
                }
            },
            {
                src: 'reveal-3.3.0/plugin/highlight/highlight.js', async: true, callback: function () {
                    hljs.initHighlightingOnLoad();
                }
            },
            {src: 'reveal-3.3.0/plugin/zoom-js/zoom.js', async: true},
            {src: 'reveal-3.3.0/plugin/notes/notes.js', async: true}
        ]
    });
</script>
</body>
</html>
